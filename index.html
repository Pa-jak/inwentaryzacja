<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Skaner kodów do Google Sheets</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <h2>Skaner kodów</h2>
  <div id="reader" style="width: 300px;"></div>
  <p id="result"></p>

  <script>
    const sheetUrl = "https://script.google.com/macros/s/AKfycbxr9kV4bccDF1KyMIzFYVVLLbth7ypGZ1_3mzLwE_FWR1ofXwzl1YTz-jPbyW4x8CmMSQ/exec";

    function onScanSuccess(decodedText) {
      document.getElementById('result').innerText = "Zeskanowano: " + decodedText;

      fetch(sheetUrl, {
        method: "POST",
        body: JSON.stringify({ code: decodedText }),
        headers: {
          "Content-Type": "application/json",
        },
      })
      .then(res => res.text())
      .then(msg => alert("Zapisano do Google Sheets: " + msg))
      .catch(err => alert("Błąd: " + err));
    }

    const html5QrCode = new Html5Qrcode("reader");
    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        html5QrCode.start(
          devices[0].id,
          {
            fps: 10,
            qrbox: 250
          },
          onScanSuccess
        );
      }
    }).catch(err => console.error(err));
  </script>
</body>
</html>
